<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Un Morpion moche</title>
    <link rel="stylesheet" href="style.css">
    <script>
        let joueur = 'X';
        const plateau = [];

        window.addEventListener('load', init);

        function analysePlateau() {
            let chaine = "";

            /* Analyse de la ligne 0 */
            for (let c = 0; c < 3; c++)
                chaine += plateau[0][c].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la ligne 1 */
            chaine = "";
            for (let c = 0; c < 3; c++)
                chaine += plateau[1][c].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la ligne 2 */
            chaine = "";
            for (let c = 0; c < 3; c++)
                chaine += plateau[2][c].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la colonne 0 */
            chaine = "";
            for (let l = 0; l < 3; l++)
                chaine += plateau[l][0].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la colonne 1 */
            chaine = "";
            for (let l = 0; l < 3; l++)
                chaine += plateau[l][1].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la colonne 2 */
            chaine = "";
            for (let l = 0; l < 3; l++)
                chaine += plateau[l][2].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la diagonale 1 */
            chaine = "";
            for (let l = 0; l < 3; l++)
                chaine += plateau[l][l].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;
            /* Analyse de la diagonale 2 */
            chaine = "";
            for (let l = 0; l < 3; l++)
                chaine += plateau[2 - l][l].textContent;
            if (chaine == "XXX" || chaine == "OOO") return true;

            return false;
        }

        function plateauRempli() {
            for (let m = 0; m < 3; m++) {
                for (let n = 0; n < 3; n++) {
                    if (plateau[m][n].textContent == "") {
                        return false;
                    }

                }
            }
            return true;
        }

        function plateauDisabled() {
            for (let m = 0; m < 3; m++) {
                for (let n = 0; n < 3; n++) {
                    plateau[m][n].disabled = true;
                }
            }
        }

        function clearBouton() {
            joueur = 'X';
            document.getElementById('message').textContent = "";

            for (let m = 0; m < 3; m++) {
                for (let n = 0; n < 3; n++) {
                    let btn = plateau[m][n];
                    btn.textContent = "";
                    btn.disabled = false;
                    btn.addEventListener("click", jouer);
                }
            }
        }


        function jouer() {
            this.textContent = joueur;
            this.disabled = true;
            let resultatMatch = analysePlateau();
            if (resultatMatch) {
                let p = document.getElementById('message');
                p.textContent = 'Le vainqueur est le joueur ' + joueur;
                plateauDisabled();
            } else if (!resultatMatch && plateauRempli()) {
                let p = document.getElementById('message');
                p.textContent = 'Match nul ';
                plateauDisabled();
            }
            if (joueur == 'X') joueur = 'O';
            else joueur = 'X';
        }

        function createPlateau() {
            const plateauDiv = document.getElementById("plateau");

            for (let i = 0; i < 3; i++) {
                plateau[i] = []; 
                for (let j = 0; j < 3; j++) {
                    let btn = document.createElement("button");
                    btn.className = "bt";    
                    btn.id = `bt${i * 3 + j + 1}`;
                    btn.addEventListener("click", jouer); 
                    plateau[i][j] = btn;
                    plateauDiv.append(btn);
                }
                
                plateauDiv.append(document.createElement("br"));
            }
        }

        function init() {

            createPlateau() 
            
            // plateau est une matrice 3x3
            for (let i = 0; i < 3; i++) plateau[i] = new Array(3);
            let b;
            b = document.getElementById("bt1");
            plateau[0][0] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt2");
            plateau[0][1] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt3");
            plateau[0][2] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt4");
            plateau[1][0] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt5");
            plateau[1][1] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt6");
            plateau[1][2] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt7");
            plateau[2][0] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt8");
            plateau[2][1] = b;
            b.addEventListener("click", jouer);
            b = document.getElementById("bt9");
            plateau[2][2] = b;
            b.addEventListener("click", jouer);

            btnRejouer = document.getElementById("btRejouer");
            btnRejouer.addEventListener("click", clearBouton);
        }
    </script>
</head>

<body>
    <div id="plateau">
    </div>
    <p id="message"></p>
    <button type="button" id="btRejouer">REJOUER ?</button>
</body>

</html>